FROM ubuntu:noble AS ubuntu-gcc
ENV DEBIAN_FRONTEND=noninteractive

RUN apt update && \
    apt install -y build-essential && \
    rm -rf /var/lib/apt/lists/*

FROM ubuntu-gcc AS build
WORKDIR /connection
COPY . .
RUN make re

FROM ubuntu-gcc AS release
WORKDIR /connection
COPY --from=build /connection/con_lib.a ./con_lib.a
COPY --from=build /connection/inc/core_lib.h ./core_lib.h
